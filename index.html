<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBUU ÏÉÅÌíà ÏÑ†ÌÉù</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffdee9 0%, #fff5f8 100%);
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(255,182,217,0.2);
        }

        h1 {
            text-align: center;
            color: #ff9fc7;
            margin-bottom: 25px;
            font-size: 1.6em;
        }

        .product-thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-right: 15px;
            border: 2px solid #ffdee9;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.15em;
                margin-bottom: 18px;
            }

            .product-item {
                padding: 10px;
            }

            .product-thumbnail {
                width: 80px;
                height: 80px;
            }

            .product-name {
                font-size: 0.75em;
            }

            .product-detail {
                font-size: 0.65em;
            }

            .product-price {
                font-size: 0.7em;
            }

            .option-select {
                min-width: 90px;
                font-size: 0.7em;
                padding: 7px 9px;
            }

            .quantity-control button {
                width: 28px;
                height: 28px;
                font-size: 13px;
            }

            .quantity-control input {
                width: 40px;
                font-size: 0.75em;
            }

            .selected-option {
                font-size: 0.7em;
            }

            .option-item {
                padding-left: 92px;
            }

            .remove-option-btn {
                font-size: 0.65em;
                padding: 5px 9px;
            }

            .summary {
                padding: 16px;
            }

            .summary-row {
                font-size: 0.85em;
            }

            .summary-row.total {
                font-size: 1.1em;
            }

            .reset-button, .export-button {
                font-size: 0.85em;
                padding: 11px;
            }

            #orderSummary {
                padding: 18px;
            }

            #orderSummary h2 {
                font-size: 1.1em;
            }

            .order-item-name {
                font-size: 0.75em;
            }

            .order-item-option {
                font-size: 0.65em;
            }

            .order-item-price {
                font-size: 0.8em;
            }

            .order-total {
                font-size: 1.15em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.1em;
            }

            .product-thumbnail {
                width: 70px;
                height: 70px;
            }

            .product-name {
                font-size: 0.72em;
            }

            .product-detail {
                font-size: 0.62em;
            }

            .product-price {
                font-size: 0.68em;
            }

            .product-controls {
                flex-wrap: wrap;
                width: 100%;
                margin-top: 6px;
            }

            .option-select {
                width: 100%;
                font-size: 0.7em;
            }

            .option-list {
                gap: 6px;
                margin-top: 8px;
                padding-top: 8px;
            }

            .option-item {
                padding-left: 0;
                gap: 8px;
            }

            .selected-option {
                font-size: 0.7em;
                min-width: 50px;
            }

            .quantity-control {
                gap: 5px;
            }

            .quantity-control button {
                width: 26px;
                height: 26px;
                font-size: 12px;
            }

            .quantity-control input {
                width: 38px;
                font-size: 0.7em;
            }

            .remove-option-btn {
                margin-left: 0;
                font-size: 0.62em;
                padding: 5px 8px;
            }

            .summary {
                padding: 14px;
            }

            .summary-row {
                font-size: 0.8em;
            }

            .summary-row.total {
                font-size: 1.05em;
            }

            .reset-button, .export-button {
                font-size: 0.8em;
                padding: 10px;
            }

            #orderSummary {
                padding: 14px;
            }

            #orderSummary h2 {
                font-size: 1em;
            }

            .order-item {
                padding: 10px;
            }

            .order-item img {
                width: 40px;
                height: 40px;
            }

            .order-item-name {
                font-size: 0.72em;
            }

            .order-item-option {
                font-size: 0.62em;
            }

            .order-item-price {
                font-size: 0.75em;
            }

            .order-total {
                font-size: 1.05em;
            }
        }

        .product-list {
            margin-bottom: 25px;
        }

        .product-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            margin-bottom: 10px;
            background: #fff9fb;
            border-radius: 10px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .product-item:hover {
            background: #fff0f6;
            border-color: #ffdee9;
        }

        .product-item.selected {
            background: #fff0f6;
            border-color: #ffb6d9;
        }

        .product-main {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .product-info {
            flex: 1;
            min-width: 0;
        }

        .product-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .product-detail {
            font-size: 0.8em;
            color: #868e96;
        }

        .product-price {
            font-weight: bold;
            color: #ff9fc7;
            margin-right: 15px;
            min-width: 80px;
            text-align: right;
            flex-shrink: 0;
        }

        .product-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .option-select {
            padding: 10px 12px;
            border: 2px solid #ffdee9;
            border-radius: 5px;
            background: white;
            color: #868e96;
            cursor: pointer;
            font-size: 0.9em;
            min-width: 120px;
            min-height: 40px;
        }

        .option-select:focus {
            outline: none;
            border-color: #ffb6d9;
        }

        .option-select.has-selection {
            color: #495057;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-control button {
            width: 30px;
            height: 30px;
            border: none;
            background: #ffb6d9;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.3s;
            touch-action: manipulation;
        }

        .quantity-control button:hover {
            background: #ff9fc7;
        }

        .quantity-control button:disabled {
            background: #ffdee9;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            border: 2px solid #ffdee9;
            border-radius: 5px;
            padding: 6px;
            font-weight: bold;
            font-size: 0.95em;
            min-height: 30px;
        }

        .remove-option-btn {
            background: transparent;
            color: #ff9fc7;
            border: 2px solid #ffb6d9;
            border-radius: 5px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s;
            margin-left: 8px;
            font-weight: bold;
            touch-action: manipulation;
            min-height: 36px;
        }

        .remove-option-btn:hover {
            background: #ffb6d9;
            color: white;
        }

        .selected-option {
            font-size: 0.9em;
            font-weight: 600;
            color: #495057;
            min-width: 60px;
        }

        .option-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ffdee9;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .summary {
            background: linear-gradient(135deg, #ffb6d9 0%, #ffdee9 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.9em;
        }

        .summary-row.total {
            border-top: 2px solid white;
            padding-top: 12px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .reset-button, .export-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
            min-height: 44px;
        }

        .reset-button {
            background: white;
            color: #ff9fc7;
        }

        .reset-button:hover {
            background: #fff9fb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,182,217,0.3);
        }

        .export-button {
            background: white;
            color: #ff9fc7;
        }

        .export-button:hover {
            background: #fff9fb;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,182,217,0.3);
        }

        #orderSummary {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }

        #orderSummary h2 {
            color: #ff9fc7;
            margin-bottom: 18px;
            text-align: center;
            font-size: 1.2em;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: #fff9fb;
            border-radius: 10px;
            border: 2px solid #ffdee9;
        }

        .order-item img {
            width: 45px;
            height: 45px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 12px;
        }

        .order-item-info {
            flex: 1;
        }

        .order-item-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 3px;
            font-size: 0.8em;
        }

        .order-item-option {
            font-size: 0.7em;
            color: #868e96;
        }

        .order-item-price {
            font-weight: bold;
            color: #ff9fc7;
            text-align: right;
            font-size: 0.85em;
        }

        .order-total {
            text-align: right;
            font-size: 1.25em;
            font-weight: bold;
            color: #ff9fc7;
            margin-top: 18px;
            padding-top: 18px;
            border-top: 3px solid #ffdee9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõçÔ∏è BBUU ÏÉÅÌíà ÏÑ†ÌÉùÌïòÍ∏∞</h1>
        
        <div class="product-list" id="productList"></div>
        
        <div class="summary">
            <div class="summary-row">
                <span>ÏÑ†ÌÉùÌïú ÏÉÅÌíà:</span>
                <span id="selectedCount">0Í∞ú</span>
            </div>
            <div class="summary-row total">
                <span>Ï¥ù Í∏àÏï°:</span>
                <span id="totalPrice">‚Ç©0</span>
            </div>
            <div class="button-group">
                <button class="reset-button" onclick="resetAll()">Ï†ÑÏ≤¥ Ï¥àÍ∏∞Ìôî</button>
                <button class="export-button" onclick="exportOrder()">Ï£ºÎ¨∏ÏÑú ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
            </div>
        </div>

        <div id="orderSummary">
            <h2>üéÄ BBUU Ï£ºÎ¨∏ÏÑú</h2>
            <div id="orderItems"></div>
            <div class="order-total" id="orderTotal"></div>
        </div>
    </div>

    <script>
        const products = [
            { id: 1, name: "BBUU PHOTOCARD PACK", detail: "5EA, 1 SET", price: 7000, image: "https://cafe24img.poxo.com/vlastshop/web/product/big/202512/11665432b0b124e5975ea61ddc676a40.jpg", options: null },
            { id: 2, name: "BBUU TRADING CAN BADGE", detail: "RANDOM 1 OUT OF 5", price: 5000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/b33df5877524dfa72c186fcdc0637cd2.jpg", options: null },
            { id: 3, name: "BBUU ACRYLIC STICK KEYRING", detail: "", price: 19000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/dd310690697f9acff807a4f6a14e2d71.jpg", options: ["ÏòàÏ§Ä", "ÎÖ∏ÏïÑ", "Î∞§ÎπÑ", "ÏùÄÌò∏", "ÌïòÎØº"] },
            { id: 4, name: "BBUU ACRYLIC CHARM KEYRING", detail: "", price: 7500, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/14a89cdc1d641e0f6b5287ea26ecbf0d.jpg", options: ["ÏòàÏ§Ä", "ÎÖ∏ÏïÑ", "Î∞§ÎπÑ", "ÏùÄÌò∏", "ÌïòÎØº"] },
            { id: 5, name: "BBUU TURN-AROUND ACRYLIC PHOTOCARD STAND", detail: "", price: 25000, image: "https://cafe24img.poxo.com/vlastshop/web/product/big/202512/8563ef40d18a774c881f84e45794db21.jpg", options: ["ÏòàÏ§Ä", "ÎÖ∏ÏïÑ", "Î∞§ÎπÑ", "ÏùÄÌò∏", "ÌïòÎØº"] },
            { id: 6, name: "BBUU STICKER PACK", detail: "26 PCS, 1 SET", price: 13000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/993358dfa7038d963087cb2380bce801.jpg", options: null },
            { id: 7, name: "BBUU CEREAL BOWL", detail: "", price: 22000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/e6f9d01f5bffe2e61f86f588fc06cd58.jpg", options: null },
            { id: 8, name: "BBUU FUR BINDER", detail: "", price: 25000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/acb0b5913fcecaa8345ffc151dd8b436.jpg", options: ["DREAMHOUSE", "TEACUP"] },
            { id: 9, name: "BBUU TRADING MINIATURE KEYRING", detail: "RANDOM 1 OUT OF 5", price: 6000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/10831ebbab14dcd07d66172e49c7307b.jpg", options: null },
            { id: 10, name: "BBUU FACE CUSHION", detail: "", price: 25000, image: "https://cafe24img.poxo.com/vlastshop/web/product/medium/202512/8eeff3998c81cf1b7ffe7de2bd770dca.jpg", options: ["ÏòàÏ§Ä", "ÎÖ∏ÏïÑ", "Î∞§ÎπÑ", "ÏùÄÌò∏", "ÌïòÎØº"] }
        ];

        // ÏÉÅÌíàÎ≥Ñ ÏÑ†ÌÉùÎêú ÏòµÏÖòÍ≥º ÏàòÎüâ Ï†ÄÏû•
        // { productId: [{ option: 'optionName', quantity: number }, ...] }
        let selectedItems = {};
        products.forEach(p => selectedItems[p.id] = []);

        function renderProducts() {
            const container = document.getElementById('productList');
            container.innerHTML = products.map(product => {
                const items = selectedItems[product.id];
                const hasItems = items.length > 0;

                // ÏòµÏÖòÏù¥ ÏûàÎäî ÏÉÅÌíà
                if (product.options) {
                    const usedOptions = items.map(item => item.option);
                    const availableOptions = product.options.filter(opt => !usedOptions.includes(opt));
                    
                    let html = `<div class="product-item ${hasItems ? 'selected' : ''}">
                        <div class="product-main">
                            <img src="${product.image}" alt="${product.name}" class="product-thumbnail">
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                ${product.detail ? `<div class="product-detail">${product.detail}</div>` : ''}
                                <div class="product-price">‚Ç©${product.price.toLocaleString()}</div>
                            </div>
                            <div class="product-controls">
                                <select class="option-select ${hasItems ? 'has-selection' : ''}" onchange="addOptionFromSelect(${product.id}, this)">
                                    <option value="">ÏòµÏÖò ÏÑ†ÌÉù</option>
                                    ${availableOptions.map(opt => 
                                        `<option value="${opt}">${opt}</option>`
                                    ).join('')}
                                </select>
                            </div>
                        </div>`;

                    // ÏÑ†ÌÉùÎêú ÏòµÏÖòÎì§ÏùÑ Í∞ôÏùÄ Î∞ïÏä§ ÏïàÏóê ÌëúÏãú
                    if (items.length > 0) {
                        html += `<div class="option-list">`;
                        items.forEach((item, idx) => {
                            html += `<div class="option-item">
                                <div class="selected-option">${item.option}</div>
                                <div style="flex: 1;"></div>
                                <div class="quantity-control">
                                    <button onclick="decreaseOptionQuantity(${product.id}, ${idx})">-</button>
                                    <input type="number" value="${item.quantity}" min="1" max="99" 
                                           onchange="updateOptionQuantity(${product.id}, ${idx}, this.value)">
                                    <button onclick="increaseOptionQuantity(${product.id}, ${idx})">+</button>
                                </div>
                                <button class="remove-option-btn" onclick="removeOption(${product.id}, ${idx})">ÏÇ≠Ï†ú</button>
                            </div>`;
                        });
                        html += `</div>`;
                    }

                    html += `</div>`;
                    return html;
                } else {
                    // ÏòµÏÖòÏù¥ ÏóÜÎäî ÏÉÅÌíà
                    const quantity = items.length > 0 ? items[0].quantity : 0;
                    return `<div class="product-item ${quantity > 0 ? 'selected' : ''}">
                        <div class="product-main">
                            <img src="${product.image}" alt="${product.name}" class="product-thumbnail">
                            <div class="product-info">
                                <div class="product-name">${product.name}</div>
                                ${product.detail ? `<div class="product-detail">${product.detail}</div>` : ''}
                                <div class="product-price">‚Ç©${product.price.toLocaleString()}</div>
                            </div>
                            <div class="quantity-control">
                                <button onclick="decreaseQuantity(${product.id})" ${quantity <= 0 ? 'disabled' : ''}>-</button>
                                <input type="number" value="${quantity}" min="0" max="99" 
                                       onchange="updateQuantity(${product.id}, this.value)">
                                <button onclick="increaseQuantity(${product.id})">+</button>
                            </div>
                        </div>
                    </div>`;
                }
            }).join('');
            updateSummary();
        }

        function addOptionFromSelect(productId, selectElement) {
            const option = selectElement.value;
            if (option && !selectedItems[productId].find(item => item.option === option)) {
                selectedItems[productId].push({ option: option, quantity: 1 });
                selectElement.value = ""; // ÏÑ†ÌÉù Ï¥àÍ∏∞Ìôî
                renderProducts();
            }
        }

        function removeOption(productId, index) {
            selectedItems[productId].splice(index, 1);
            renderProducts();
        }

        function increaseOptionQuantity(productId, index) {
            if (selectedItems[productId][index].quantity < 99) {
                selectedItems[productId][index].quantity++;
                renderProducts();
            }
        }

        function decreaseOptionQuantity(productId, index) {
            if (selectedItems[productId][index].quantity > 1) {
                selectedItems[productId][index].quantity--;
                renderProducts();
            }
        }

        function updateOptionQuantity(productId, index, value) {
            const num = parseInt(value) || 1;
            selectedItems[productId][index].quantity = Math.max(1, Math.min(99, num));
            renderProducts();
        }

        function increaseQuantity(productId) {
            if (selectedItems[productId].length === 0) {
                selectedItems[productId].push({ option: null, quantity: 1 });
            } else if (selectedItems[productId][0].quantity < 99) {
                selectedItems[productId][0].quantity++;
            }
            renderProducts();
        }

        function decreaseQuantity(productId) {
            if (selectedItems[productId].length > 0 && selectedItems[productId][0].quantity > 0) {
                selectedItems[productId][0].quantity--;
                if (selectedItems[productId][0].quantity === 0) {
                    selectedItems[productId] = [];
                }
                renderProducts();
            }
        }

        function updateQuantity(productId, value) {
            const num = parseInt(value) || 0;
            if (num === 0) {
                selectedItems[productId] = [];
            } else if (selectedItems[productId].length === 0) {
                selectedItems[productId].push({ option: null, quantity: Math.max(0, Math.min(99, num)) });
            } else {
                selectedItems[productId][0].quantity = Math.max(0, Math.min(99, num));
            }
            renderProducts();
        }

        function updateSummary() {
            let total = 0;
            let totalQuantity = 0;

            products.forEach(product => {
                const items = selectedItems[product.id];
                items.forEach(item => {
                    total += product.price * item.quantity;
                    totalQuantity += item.quantity;
                });
            });

            document.getElementById('selectedCount').textContent = `${totalQuantity}Í∞ú`;
            document.getElementById('totalPrice').textContent = `‚Ç©${total.toLocaleString()}`;
        }

        function resetAll() {
            if (confirm('Î™®Îì† ÏÑ†ÌÉùÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                products.forEach(p => selectedItems[p.id] = []);
                renderProducts();
            }
        }

        async function exportOrder() {
            let total = 0;
            let orderHTML = '';

            products.forEach(product => {
                const items = selectedItems[product.id];
                items.forEach(item => {
                    const subtotal = product.price * item.quantity;
                    total += subtotal;
                    
                    orderHTML += `<div class="order-item">
                        <img src="${product.image}" alt="${product.name}" crossorigin="anonymous">
                        <div class="order-item-info">
                            <div class="order-item-name">${product.name}</div>
                            ${item.option ? `<div class="order-item-option">ÏòµÏÖò: ${item.option}</div>` : ''}
                            <div class="order-item-option">ÏàòÎüâ: ${item.quantity}Í∞ú</div>
                        </div>
                        <div class="order-item-price">‚Ç©${subtotal.toLocaleString()}</div>
                    </div>`;
                });
            });

            if (orderHTML === '') {
                alert('ÏÑ†ÌÉùÎêú ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§!');
                return;
            }

            document.getElementById('orderItems').innerHTML = orderHTML;
            document.getElementById('orderTotal').textContent = `Ï¥ù Í∏àÏï°: ‚Ç©${total.toLocaleString()}`;
            document.getElementById('orderSummary').style.display = 'block';

            // Ïù¥ÎØ∏ÏßÄÍ∞Ä Î°úÎìúÎê† ÎïåÍπåÏßÄ ÎåÄÍ∏∞
            await new Promise(resolve => setTimeout(resolve, 500));

            const element = document.getElementById('orderSummary');
            const canvas = await html2canvas(element, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true
            });

            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                const date = new Date().toISOString().slice(0, 10);
                link.download = `BBUU_Ï£ºÎ¨∏ÏÑú_${date}.png`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
                
                document.getElementById('orderSummary').style.display = 'none';
            });
        }

        renderProducts();
    </script>
</body>
</html>
